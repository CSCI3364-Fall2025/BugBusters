{% extends 'base.html' %}
{% load socialaccount %}
{% load static %}

{% block title %}To Do - EagleOps{% endblock %}

{% block content %}
  <div class="copy">
    <div class="page-title">
      <div class="text-wrapper-11"><h1>EagleOps Peer Evaluation</h1></div>
      <p class="text-wrapper-12">
        Welcome, {{ user.userprofile.first_name }}!
        Click the buttons below to begin completing feedback forms for your teammates.
      </p>
    </div>
  </div>

  <!-- Dropdown -->
  <div class="section">
    <div class="dialog-body">
      <label for="team-select" class="dropdown-label">Select a course and team:</label>
      <select name="team" id="team-select" class="form-control dropdown-select">
        <option value="" disabled selected>------</option>
        {% for item in course_data %}
          <option value="{{ item.team.id }}">
            {{ item.course_name }} - {{ item.team.name }}
          </option>
        {% endfor %}
      </select>
      
      <div id="forms-container" class="team-boxes">
        {% for item in course_data %}
          {% for form in item.forms %}
            <div class="form-card team-box" data-team-id="{{ item.team.id }}" style="display: none;">
              <div class="form-card-inner">
                <div class="form-card-header">
                  <div class="text-heading">{{ form.title }}</div> 
                  <p class="body-text">
                    <span class="span">Due in </span> 
                    <span class="text-wrapper-13">{{ form.time_left }}</span>
                  </p>
                </div>
                <div class="button-group">
                  {% if form.status == 'active' %}
                    <button class="action-button btn-primary"><span class="button-5">Begin</span></button>
                  {% elif form.status == 'closed' %}
                    <button class="action-button btn-danger"><span class="button-7">Closed</span></button>
                  {% else %}
                    <button class="action-button btn-secondary"><span class="button-7">Scheduled</span></button>
                  {% endif %}
                </div>
                <div class="form-card-footer">
                  <div class="text-wrapper-14">Published on {{ form.publication_date|date:"M d, Y" }}</div>
                </div>
              </div>
            </div>
          {% endfor %}
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- JavaScript to control form visibility -->
  <script>
    const teamSelect = document.getElementById('team-select');
    const formCards = document.querySelectorAll('.form-card');

    teamSelect.addEventListener('change', function() {
      const selectedTeamId = this.value;

      formCards.forEach(card => {
        if (card.getAttribute('data-team-id') === selectedTeamId) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    });
  </script>
{% endblock %}