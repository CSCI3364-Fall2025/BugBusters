{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}EagleOps{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&family=Work+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="{% get_static_prefix %}css/styles.css">
    {% block extra_css %}{% endblock %}
</head>

<body>
    
    {% if user.is_authenticated %}
    <nav class="navbar">
        <a href="/" class="brand">EagleOps Peer Evaluation</a>
        <ul class="nav-links">
            <li class="course-selector">
                <select id="course-select" onchange="updateSelectedCourse(this.value)">
                    {% for course in available_courses %}
                        <option value="{{ course.id }}" {% if course.id == selected_course.id %}selected{% endif %}>
                            {{ course.code }}: {{ course.name }}
                        </option>
                    {% endfor %}
                </select>
            </li>
            {% if not user.userprofile.admin %}
                <li><a href="{% url 'todo' %}">To Do</a></li>
                <li><a href="{% url 'teams' %}">Team</a></li>
            {% endif %}
            <li><a href="{% url 'courses' %}">Courses</a></li>
            {% if user.userprofile.admin %}
                <li><a href="{% url 'forms_dashboard' %}">Forms</a></li>
                {% if selected_course %}
                    <li><a href="{% url 'roster_current' %}">Roster</a></li>
                {% endif %}
            {% endif %}
            {% if selected_course %}
                <li><a href="{% url 'performance' course_id=selected_course.id %}">Performance</a></li>
            {% else %}
            <li><a href="#" class="disabled-link">Performance</a></li>
            {% endif %}
            <li class="dropdown">
                <a href="/" class="active">Profile</a>
                <div class="dropdown-content">
                    <a href="{% url 'home' %}">My Profile</a>
                    <a href="{% url 'account_logout' %}?next=/">Logout</a>
                </div>
            </li>
        </ul>
    </nav>
    {% endif %}

    <!-- Messages display -->
    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
            {{ message }}
            <button class="close-message" onclick="this.parentElement.style.display='none';">&times;</button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="content">
        {% block content %}
        
        {% endblock %}
    </div>

<footer>
    <div class="footer-content">
        <p>Contact Us: eagleopspeerevaluations@gmail.com | (123) 456-7890</p>
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 EagleOps</p>
    </div>
</footer>

{% block extra_js %}{% endblock %}

<style>
    .messages-container {
        max-width: 1000px;
        margin: 10px auto;
        padding: 0 20px;
    }
    
    .message {
        padding: 12px 15px;
        margin-bottom: 10px;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .message.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    
    .message.warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
    }
    
    .message.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    
    .close-message {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        padding: 0 0 0 10px;
        color: inherit;
        opacity: 0.7;
    }
    
    .close-message:hover {
        opacity: 1;
    }
    
    .course-selector {
        margin: 0 10px;
    }
    
    .course-selector select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: white;
        font-size: 14px;
        color: #ffffff;
        cursor: pointer;
        min-width: 200px;
    }
    
    .course-selector select:focus {
        outline: none;
        border-color: #4a90e2;
        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
    }
</style>

<script>
    // Auto-hide messages after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
        const messages = document.querySelectorAll('.message');
        messages.forEach(message => {
            setTimeout(() => {
                message.style.opacity = '0';
                message.style.transition = 'opacity 0.5s ease';
                setTimeout(() => {
                    message.style.display = 'none';
                }, 500);
            }, 5000);
        });
    });
    
    function updateSelectedCourse(courseId) {
        fetch('/update-selected-course/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({ course_id: courseId })
        }).then(response => {
            if (response.ok) {
                // Reload the page to update the content
                window.location.reload();
            }
        });
    }
    
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
</body>
</html>
